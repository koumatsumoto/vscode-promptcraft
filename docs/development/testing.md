# VSCode拡張機能のテスト実装方針

## Unit Test

- vitestを使用
- vitestでは、以下の外部依存性を必ずmockする：
  - ファイル操作（fs, path等）
  - ネットワーク通信
  - vscodeモジュール
- モック方法：
  - `vi.mock()` を使用して依存モジュールをモック
  - 必要に応じて `vi.spyOn()` で関数の呼び出しを検証
- テストカバレッジ目標：
  - ロジックを含むコアモジュールは80%以上
  - ユーティリティ関数は90%以上
- 実行頻度：
  - CI/CDパイプラインの一部として毎回実行
  - 開発中はローカルで実行可能
- 実ファイルI/OやVSCode APIへの依存を含むテストはintegration testまたはE2E testでのみ許可

## Integration Test

- vscode-test を利用してアプリケーション全体をテスト
- テスト対象：
  - コマンド実行
  - 設定の読み込みと反映
  - UI要素（Webviewなど）の正常な表示
  - エラーハンドリング
- テスト環境：
  - 実際のVSCode環境で実行
  - 必要に応じてテスト用のワークスペースとファイルを用意
- 実行頻度：
  - プルリクエスト時
  - リリース前の検証
  - 大きな機能追加や変更時

## E2E Test

- ユーザーの実際の使用シナリオを再現するテスト
- テスト内容：
  - 拡張機能のインストールから起動まで
  - 一連の操作フローの検証
  - 異なるOSやVSCodeバージョンでの互換性
- 実装方法：
  - Playwright や Selenium などの自動化ツールの活用を検討
  - CI環境での自動実行

## テストデータ管理

- テスト用のフィクスチャーは `__fixtures__` ディレクトリに配置
- モックデータは `__mocks__` ディレクトリに保存
- スナップショットテストを活用して、UI要素やコマンド出力の変更を検知

## テスト運用方針

- 新機能追加時には対応するテストの作成を必須とする
- テストファイルの命名規則：
  Unit Test: `[テスト対象ファイル名].test.ts`
  Integration Test: `[テスト対象ファイル名].vscode-test.ts`
- CI/CDパイプラインでのテスト自動化
- テストカバレッジレポートの定期的な確認
- テスト失敗時のデバッグ手順の文書化

## 推奨ライブラリとツール

- vitest: ユニットテスト用フレームワーク
- @vitest/coverage-v8: ユニットテストのカバレッジ計測
- vscode-test: 拡張機能の統合テスト用
