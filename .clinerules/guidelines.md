# 開発支援 AI ガイドライン

## 基本方針

### 1. ユーザーの設計方針に忠実にコード実装を行う

- ユーザーが明示的に指定した設計パターンやアーキテクチャに従う
- ユーザーの意図を尊重し、過度な最適化や独自の改良は行わない
- 実装中に選択肢がある場合は、選択肢を提示してユーザーに判断を仰ぐ

### 2. 情報不足の場合は必要なコンテキストを明示的に質問する

- 必要な情報を箇条書きで具体的に質問する
- 質問する際は、なぜその情報が必要かを簡潔に説明する
- 複数の質問がある場合は優先度の高い質問から順に提示する

### 3. 問題解決に 5 回以上試行しても成功しない場合はユーザーに確認する

- 試行した内容と結果を簡潔に要約して報告する
- 考えられる原因と代替アプローチを 2〜3 個提案する
- ユーザーに方針変更または追加情報を求める

## 作業フロー

### 作業開始前

#### 1. 作業内容が不明確な場合はユーザに質問する

- 「何を実装すべきか」「どのような機能が必要か」など具体的に質問する
- 既存コードの構造やパターンについての情報を求める
- プロジェクトで使用している技術スタックの確認を行う

#### 2. 作業内容を分析して設計方針を作成する

- 実装する機能の目的と範囲を明確に定義する
- 必要なコンポーネントやモジュールを特定する
- 依存関係やインターフェースを明確にする

#### 3. 作成した設計方針とこれから進める実装手順を整理してユーザに報告する

- 実装手順は具体的なステップに分解し、番号付きリストで提示する
- 各ステップで作成/修正するファイルを明記する
- 想定される所要時間や難易度があれば記載する

### 機能実装後

#### 1. 実装に合わせて `docs/` の仕様書を更新する

- 新しい機能や変更点を明確に文書化する
- API 仕様やインターフェースの変更を反映させる
- サンプルコードや使用例を必要に応じて追加する

#### 2. 仕様にあわせてテストを追加変更する

- 少なくとも正常系と異常系の基本パターンをカバーするテストを作成する
- 変更した機能に関連する既存テストも必要に応じて更新する
- テストカバレッジが十分であるか確認する

#### 3. `npm run fmt` でコードフォーマットする

- フォーマット実行後、変更された箇所を確認する
- フォーマットによって意図しない動作変更がないか確認する

### 作業完了後

#### 1. `npm run ci` を実行して成功確認する

- CI が失敗した場合は、エラーログを分析して問題を修正する
- テスト、リント、ビルドのすべてが正常に完了することを確認する

#### 2. 作業内容を git commit message の形式で整理してユーザに報告する

- 指示の最初から現在まで行ったものを全て含める
- 変更内容を機能単位でグループ化して説明する
- 重要な決定事項や設計上の選択肢について言及する
- 未解決の問題や今後の課題があれば明記する
- 複数の作業が含まれる場合は、時系列順に整理する

## 省略指示

### `commit` 指示の取り扱い

`commit` と指示された場合は、これまでの変更内容を `git commit` することを意図している。

**手順:**

- 変更ファイル一覧、各ファイルの主な変更点の要約を提示する
- コミット規約に従ってメッセージを作成する
- コミットメッセージ案を提示し、ユーザーの承認を得てから進める

## Git 操作ルール

### コミット規約

#### 1. `-m`フラグを使用し、英語でコミットメッセージを作成する

例: `git commit -m "feat: add user authentication"`

#### 2. Conventional Commits 形式を使用する

- 形式: `<type>: <description>`
- 一般的な type: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`
- description は命令形の現在形で、50 文字以内で簡潔に記述する

#### 3. 三行目以降に具体的な作業内容をリスト形式で記述する

例:

```
feat: implement user authentication API

- Add JWT token generation and validation
- Create user login and registration endpoints
- Implement password hashing with bcrypt
- Add authentication middleware
```

#### 4. コミット前にメッセージが適切かどうかをユーザーに確認する

- コミットメッセージ案を提示し、承認を得てから実行する
- 必要に応じて修正案も提示する

### 差分確認ルール

#### 1. `package-lock.json`, `poetry.lock` の差分は参照しない

- 代わりに `package.json`, `pyproject.toml` を参照する
- 依存関係の変更を確認する際は、バージョン番号や新しく追加されたパッケージに注目する

#### 2. ビルドファイル、自動生成ファイル、バイナリファイルの差分は無視する

無視すべきファイルタイプ: `.min.js`, `.bundle.js`, `dist/`, `build/`, `.log`, `.tmp`など

#### 3. 差分確認のコマンドは `git --no-pager diff | head -n 500` を使う

- 大規模な差分の場合は、特定のファイルに絞って `git --no-pager diff <filepath>` を使用する
- 必要に応じて `--stat` オプションを使って変更ファイルの概要を確認する

#### 4. 大きな差分ファイルを発見した場合はユーザーに報告し指示を仰ぐ

- ファイル全体の差分が必要かどうかをユーザーに確認する
